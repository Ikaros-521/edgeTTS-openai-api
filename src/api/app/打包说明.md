# PyInstaller 打包说明

## 问题解决

如果遇到 `ImportError: DLL load failed while importing pyexpat` 错误，请使用以下方法：

## 方法 1：使用 .spec 文件打包（推荐）

1. 使用提供的 `Edge-TTS-API.spec` 文件打包：

```bash
cd src/api/app
pyinstaller Edge-TTS-API.spec
```

打包后的 exe 文件会在 `dist` 目录中。

## 方法 2：使用命令行打包

```bash
cd src/api/app
pyinstaller --onefile --console --name Edge-TTS-API ^
    --add-data "index.html;." ^
    --hidden-import pkg_resources.py2_warn ^
    --hidden-import xml.parsers.expat ^
    --hidden-import xml.parsers.pyexpat ^
    --hidden-import edge_tts ^
    --hidden-import flask ^
    --hidden-import gevent ^
    --hidden-import dotenv ^
    --hidden-import asyncio ^
    --hidden-import subprocess ^
    --hidden-import tempfile ^
    --collect-all edge_tts ^
    --collect-all flask ^
    server.py
```

## 方法 3：如果仍然有问题，尝试以下步骤

1. 更新 PyInstaller 到最新版本：
```bash
pip install --upgrade pyinstaller
```

2. 清理之前的构建：
```bash
pyinstaller --clean Edge-TTS-API.spec
```

3. 如果问题仍然存在，可能需要手动复制 DLL 文件。检查 Python 安装目录下的 `DLLs` 文件夹，找到 `pyexpat.pyd` 文件。

## 注意事项

- 确保所有依赖都已安装：`pip install -r requirements.txt`
- 打包前建议在虚拟环境中测试
- 如果使用 auto-py-to-exe，可以在 "Additional Files" 中添加 `index.html`，并确保勾选相关选项

## 验证打包

打包完成后，在 `dist` 目录中运行 `Edge-TTS-API.exe`，应该能够正常启动服务器。

